# å“¡å·¥å…¥è·æµç¨‹å„ªåŒ– + æœƒè¨ˆå“ç‰Œåˆ†é…ç®¡ç†

æœ¬æ–‡æª”èªªæ˜å…©å€‹æ–°åŠŸèƒ½çš„å¯¦ä½œå’Œä½¿ç”¨æ–¹å¼ã€‚

## ğŸ“‹ ç›®éŒ„

1. [å“¡å·¥å…¥è·æµç¨‹å„ªåŒ–ï¼ˆæ–¹æ¡ˆ Aï¼‰](#å“¡å·¥å…¥è·æµç¨‹å„ªåŒ–æ–¹æ¡ˆ-a)
2. [æœƒè¨ˆå“ç‰Œåˆ†é…ç®¡ç†](#æœƒè¨ˆå“ç‰Œåˆ†é…ç®¡ç†)
3. [éƒ¨ç½²æ­¥é©Ÿ](#éƒ¨ç½²æ­¥é©Ÿ)
4. [ä½¿ç”¨æŒ‡å—](#ä½¿ç”¨æŒ‡å—)

---

## å“¡å·¥å…¥è·æµç¨‹å„ªåŒ–ï¼ˆæ–¹æ¡ˆ Aï¼‰

### å•é¡Œæè¿°

**åŸæœ‰æµç¨‹çš„ç—›é»ï¼š**
- å…ˆå»ºç«‹å“¡å·¥è¨˜éŒ„
- ç™¼é€å¯†ç¢¼é‡è¨­ä¿¡çµ¦å“¡å·¥
- å“¡å·¥é‚„æ²’é‡è¨­å¯†ç¢¼å‰ï¼Œ`user_id` ç‚º NULL
- å°è‡´äººå“¡æ¸…å†Šä¸å®Œæ•´ï¼Œç„¡æ³•æ­£å¸¸ä½¿ç”¨

### è§£æ±ºæ–¹æ¡ˆï¼ˆæ–¹æ¡ˆ Aï¼‰

**æ”¹å–„å¾Œçš„æµç¨‹ï¼š**

```mermaid
graph LR
    A[HR å»ºç«‹å“¡å·¥] --> B[ä½¿ç”¨ Admin API å‰µå»ºå¸³è™Ÿ]
    B --> C[ç«‹å³å‰µå»ºå“¡å·¥è¨˜éŒ„ä¸¦é—œè¯ user_id]
    C --> D[ç™¼é€å¯†ç¢¼é‡è¨­é€£çµ]
    D --> E[å“¡å·¥è¨­å®šå¯†ç¢¼]
```

**ä¸»è¦æ”¹å‹•ï¼š**

1. **ä¿®æ”¹ Edge Function** (`supabase/functions/invite-employee/index.ts`)
   - ä½¿ç”¨ `admin.createUser()` å–ä»£ `inviteUserByEmail()`
   - è¨­å®š `email_confirm: true` è‡ªå‹•ç¢ºèªä¿¡ç®±
   - å‰µå»ºå“¡å·¥è¨˜éŒ„æ™‚ç«‹å³è¨­å®š `user_id`
   - ä½¿ç”¨ `generateLink()` ç”Ÿæˆå¯†ç¢¼é‡è¨­é€£çµ

2. **å„ªé»ï¼š**
   - âœ… å“¡å·¥è¨˜éŒ„å’Œå¸³è™ŸåŒæ­¥å‰µå»º
   - âœ… `user_id` ç«‹å³å­˜åœ¨ï¼Œäººå“¡æ¸…å†Šå®Œæ•´
   - âœ… å¯ä»¥é å…ˆè¨­å®šæ¬Šé™å’Œè§’è‰²
   - âœ… å“¡å·¥å¯ä»¥è‡ªå·±è¨­å®šå¯†ç¢¼

3. **éŒ¯èª¤è™•ç†ï¼š**
   - Email å·²å­˜åœ¨æ™‚æä¾›å‹å–„éŒ¯èª¤è¨Šæ¯
   - å“¡å·¥è¨˜éŒ„å‰µå»ºå¤±æ•—æ™‚è‡ªå‹•æ¸…ç†å·²å‰µå»ºçš„å¸³è™Ÿ
   - å¯†ç¢¼é‡è¨­ä¿¡ç™¼é€å¤±æ•—ä¸å½±éŸ¿å¸³è™Ÿå‰µå»º

### ç¨‹å¼ç¢¼è®Šæ›´

**Before (èˆŠç‰ˆ):**
```typescript
// ä½¿ç”¨ inviteUserByEmail
const { data: userData, error } = await supabaseAdmin.auth.admin.inviteUserByEmail(
  email,
  { data: { full_name: name } }
)

// å˜—è©¦æ›´æ–°å“¡å·¥ (ä½†å“¡å·¥è¨˜éŒ„å¯èƒ½é‚„ä¸å­˜åœ¨)
await supabaseAdmin
  .from('employees')
  .update({ ... })
  .eq('user_id', userData.user.id)
```

**After (æ–°ç‰ˆ):**
```typescript
// 1. å…ˆå‰µå»ºå¸³è™Ÿ
const { data: userData, error } = await supabaseAdmin.auth.admin.createUser({
  email: email,
  email_confirm: true,  // è‡ªå‹•ç¢ºèª
  user_metadata: { full_name: name }
})

// 2. ç«‹å³å‰µå»ºå“¡å·¥è¨˜éŒ„ä¸¦é—œè¯ user_id
await supabaseAdmin
  .from('employees')
  .insert({
    user_id: userData.user.id,  // ç«‹å³é—œè¯
    employee_id: employee_id,
    name: name,
    // ... å…¶ä»–æ¬„ä½
  })

// 3. ç™¼é€å¯†ç¢¼é‡è¨­é€£çµ
await supabaseAdmin.auth.admin.generateLink({
  type: 'recovery',
  email: email
})
```

---

## æœƒè¨ˆå“ç‰Œåˆ†é…ç®¡ç†

### åŠŸèƒ½èªªæ˜

å…è¨± HR/Admin åœ¨ç®¡ç†ä¸­å¿ƒç‚ºæœƒè¨ˆäººå“¡åˆ†é…è² è²¬çš„å“ç‰Œã€‚

**ä½¿ç”¨å ´æ™¯ï¼š**
- å…­æ‰‡é–€æœƒè¨ˆåªè™•ç†å…­æ‰‡é–€å“ç‰Œçš„ä»˜æ¬¾ç”³è«‹
- å…¶ä»–æœƒè¨ˆè™•ç†å…¶ä»–å“ç‰Œçš„ä»˜æ¬¾ç”³è«‹
- ä¸€å€‹å“ç‰Œå¯ä»¥åˆ†é…çµ¦å¤šä½æœƒè¨ˆï¼ˆå…±åŒè™•ç†ï¼‰

### è³‡æ–™åº«çµæ§‹

å·²åœ¨ `add_payment_system_enhancements.sql` ä¸­å‰µå»ºï¼š

```sql
-- æœƒè¨ˆå“ç‰Œé—œè¯è¡¨
CREATE TABLE payment_approval.accountant_brands (
    id BIGSERIAL PRIMARY KEY,
    employee_id UUID NOT NULL REFERENCES public.employees(id),
    brand_id BIGINT NOT NULL REFERENCES payment_approval.brands(id),
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    UNIQUE(employee_id, brand_id)  -- é˜²æ­¢é‡è¤‡åˆ†é…
);
```

### å‰ç«¯çµ„ä»¶

**æ–°å¢æ–‡ä»¶ï¼š**
- `src/pages/management/components/AccountantBrandsManagement.jsx`

**åŠŸèƒ½ç‰¹æ€§ï¼š**
- âœ… é¡¯ç¤ºæ‰€æœ‰æœƒè¨ˆäººå“¡åˆ—è¡¨
- âœ… é¡¯ç¤ºæ¯ä½æœƒè¨ˆå·²åˆ†é…çš„å“ç‰Œ
- âœ… ç‚ºæœƒè¨ˆæ·»åŠ /ç§»é™¤å“ç‰Œ
- âœ… çµ±è¨ˆè³‡è¨Šï¼ˆæœƒè¨ˆäººæ•¸ã€å“ç‰Œç¸½æ•¸ã€åˆ†é…é—œä¿‚ï¼‰
- âœ… å³æ™‚ç”Ÿæ•ˆï¼Œç„¡éœ€é‡æ–°ç™»å…¥

**ç®¡ç†ä¸­å¿ƒæ•´åˆï¼š**
- åœ¨ `ManagementCenter.jsx` æ–°å¢ã€Œæœƒè¨ˆå“ç‰Œåˆ†é…ã€Tab
- ä½¿ç”¨ `BadgeDollarSign` åœ–æ¨™
- åªæœ‰ Admin å’Œ HR å¯ä»¥è¨ªå•

### UI æˆªåœ–èªªæ˜

ç®¡ç†ä»‹é¢åŒ…å«ï¼š

1. **èªªæ˜å¡ç‰‡**
   - è§£é‡‹åŠŸèƒ½ç”¨é€”
   - æä¾›ä½¿ç”¨ç¯„ä¾‹

2. **çµ±è¨ˆè³‡è¨Š**
   - æœƒè¨ˆäººå“¡ç¸½æ•¸
   - å“ç‰Œç¸½æ•¸
   - åˆ†é…é—œä¿‚ç¸½æ•¸

3. **æœƒè¨ˆåˆ—è¡¨**
   - æ¯å€‹æœƒè¨ˆé¡¯ç¤ºï¼š
     - å§“åå’Œ Email
     - å·²åˆ†é…å“ç‰Œï¼ˆå½©è‰²æ¨™ç±¤ï¼‰
     - æ·»åŠ å“ç‰Œçš„ä¸‹æ‹‰é¸å–®

4. **æ“ä½œ**
   - é»æ“Š âŒ ç§»é™¤å“ç‰Œåˆ†é…
   - é¸æ“‡å“ç‰Œå¾Œé»æ“Šã€Œæ·»åŠ ã€æŒ‰éˆ•

### æ¬Šé™è¨­å®š

**RLS ç­–ç•¥ï¼š**
```sql
-- æœƒè¨ˆå¯ä»¥æŸ¥çœ‹è‡ªå·±è² è²¬çš„å“ç‰Œ
CREATE POLICY "æœƒè¨ˆå¯ä»¥æŸ¥çœ‹è‡ªå·±è² è²¬çš„å“ç‰Œ"
    ON payment_approval.accountant_brands
    FOR SELECT
    USING (employee_id IN (
        SELECT id FROM public.employees WHERE user_id = auth.uid()
    ));

-- ç®¡ç†å“¡å¯ä»¥ç®¡ç†æœƒè¨ˆå“ç‰Œ
CREATE POLICY "ç®¡ç†å“¡å¯ä»¥ç®¡ç†æœƒè¨ˆå“ç‰Œ"
    ON payment_approval.accountant_brands
    FOR ALL
    USING (
        EXISTS (
            SELECT 1 FROM public.employees
            WHERE user_id = auth.uid()
            AND role IN ('admin', 'hr')
        )
    );
```

---

## éƒ¨ç½²æ­¥é©Ÿ

### 1. è³‡æ–™åº« Migration

å¦‚æœå°šæœªåŸ·è¡Œï¼Œè«‹åŸ·è¡Œä»¥ä¸‹ migrationï¼š

```bash
# æœ¬åœ°é–‹ç™¼ç’°å¢ƒ
supabase db push

# æˆ–è€…åœ¨ Supabase Dashboard åŸ·è¡Œ
# SQL Editor â†’ è²¼ä¸Š add_payment_system_enhancements.sql å…§å®¹ â†’ Run
```

### 2. éƒ¨ç½² Edge Function

```bash
# éƒ¨ç½² invite-employee function
supabase functions deploy invite-employee

# ç¢ºèªç’°å¢ƒè®Šæ•¸å·²è¨­å®š
# SUPABASE_URL
# SUPABASE_SERVICE_ROLE_KEY
```

### 3. å‰ç«¯éƒ¨ç½²

```bash
# å®‰è£ä¾è³´ï¼ˆå¦‚æœ‰æ–°å¢ï¼‰
npm install

# æ§‹å»ºä¸¦éƒ¨ç½²
npm run build
# éƒ¨ç½²åˆ° Vercel æˆ–å…¶ä»–å¹³å°
```

### 4. é©—è­‰é…ç½®

ç¢ºèª `supabase/config.toml` åŒ…å«ï¼š

```toml
[api]
schemas = [
  "public",
  "payment_approval",  # å¿…é ˆåŒ…å«
  # ... å…¶ä»– schemas
]
```

---

## ä½¿ç”¨æŒ‡å—

### HR å¦‚ä½•ä½¿ç”¨æ–°çš„å“¡å·¥å…¥è·æµç¨‹

1. **é€²å…¥ç®¡ç†ä¸­å¿ƒ**
   - ç™»å…¥ç³»çµ±
   - é»æ“Šã€Œç®¡ç†ä¸­å¿ƒã€

2. **æ–°å¢å“¡å·¥**
   - åˆ‡æ›åˆ°ã€Œå“¡å·¥è³‡æ–™ã€Tab
   - é»æ“Šã€Œæ–°å¢å“¡å·¥ã€æŒ‰éˆ•
   - å¡«å¯«å“¡å·¥è³‡è¨Šï¼ˆå¿…é ˆåŒ…å« Emailã€å§“åã€å“¡å·¥ç·¨è™Ÿï¼‰
   - é¸æ“‡è§’è‰²ï¼ˆä¾‹å¦‚ï¼šæœƒè¨ˆï¼‰
   - é»æ“Šã€Œå»ºç«‹ã€

3. **ç³»çµ±è‡ªå‹•è™•ç†**
   - âœ… å‰µå»º Supabase èªè­‰å¸³è™Ÿ
   - âœ… å‰µå»ºå“¡å·¥è¨˜éŒ„ï¼ˆ`user_id` ç«‹å³æœ‰å€¼ï¼‰
   - âœ… ç”Ÿæˆå¯†ç¢¼é‡è¨­é€£çµ
   - âœ… å›å‚³é€£çµä¾› HR ç™¼é€çµ¦å“¡å·¥

4. **å“¡å·¥è¨­å®šå¯†ç¢¼**
   - å“¡å·¥æ”¶åˆ°å¯†ç¢¼é‡è¨­é€£çµ
   - é»æ“Šé€£çµè¨­å®šè‡ªå·±çš„å¯†ç¢¼
   - å®Œæˆå¾Œå³å¯ç™»å…¥ç³»çµ±

### å¦‚ä½•ç®¡ç†æœƒè¨ˆå“ç‰Œåˆ†é…

1. **é€²å…¥å“ç‰Œåˆ†é…ç®¡ç†**
   - ç™»å…¥ç®¡ç†ä¸­å¿ƒï¼ˆéœ€è¦ Admin æˆ– HR æ¬Šé™ï¼‰
   - åˆ‡æ›åˆ°ã€Œæœƒè¨ˆå“ç‰Œåˆ†é…ã€Tab

2. **æŸ¥çœ‹ç¾æœ‰åˆ†é…**
   - é ‚éƒ¨é¡¯ç¤ºçµ±è¨ˆè³‡è¨Š
   - æ¯ä½æœƒè¨ˆé¡¯ç¤ºå·²åˆ†é…çš„å“ç‰Œï¼ˆå½©è‰²æ¨™ç±¤ï¼‰

3. **ç‚ºæœƒè¨ˆæ·»åŠ å“ç‰Œ**
   - æ‰¾åˆ°è¦åˆ†é…çš„æœƒè¨ˆ
   - åœ¨ã€Œæ·»åŠ å“ç‰Œã€ä¸‹æ‹‰é¸å–®ä¸­é¸æ“‡å“ç‰Œ
   - é»æ“Šã€Œæ·»åŠ ã€æŒ‰éˆ•
   - âœ… åˆ†é…ç«‹å³ç”Ÿæ•ˆ

4. **ç§»é™¤å“ç‰Œåˆ†é…**
   - æ‰¾åˆ°å·²åˆ†é…çš„å“ç‰Œæ¨™ç±¤
   - é»æ“Šæ¨™ç±¤ä¸Šçš„ âŒ æŒ‰éˆ•
   - ç¢ºèªåˆªé™¤
   - âœ… ç§»é™¤ç«‹å³ç”Ÿæ•ˆ

### æœƒè¨ˆä½¿ç”¨é«”é©—

**åˆ†é…å“ç‰Œå¾Œï¼š**
- æœƒè¨ˆç™»å…¥ä»˜æ¬¾ç³»çµ±
- Dashboard åªé¡¯ç¤ºæ‰€è² è²¬å“ç‰Œçš„å¾…ç°½æ ¸æ¡ˆä»¶
- ç„¡æ³•çœ‹åˆ°å…¶ä»–å“ç‰Œçš„æ¡ˆä»¶
- åˆ†é…è¨­å®šå³æ™‚ç”Ÿæ•ˆï¼Œç„¡éœ€é‡æ–°ç™»å…¥

**æœªåˆ†é…å“ç‰Œæ™‚ï¼š**
- æœƒè¨ˆå°‡çœ‹ä¸åˆ°ä»»ä½•å¾…ç°½æ ¸æ¡ˆä»¶
- ç³»çµ±æœƒæç¤ºã€Œç„¡å¾…è™•ç†æ¡ˆä»¶ã€

---

## æ³¨æ„äº‹é …

### å“¡å·¥å…¥è·æµç¨‹

âš ï¸ **é‡è¦æé†’ï¼š**

1. **Email å¿…é ˆå”¯ä¸€**
   - å¦‚æœ Email å·²è¢«ä½¿ç”¨ï¼Œç³»çµ±æœƒè¿”å›å‹å–„éŒ¯èª¤è¨Šæ¯
   - è«‹ä½¿ç”¨å…¬å¸ Email æˆ–ç¢ºä¿å”¯ä¸€æ€§

2. **å¯†ç¢¼é‡è¨­é€£çµ**
   - ç›®å‰ä½¿ç”¨ `generateLink()` ç”Ÿæˆé€£çµ
   - HR éœ€è¦æ‰‹å‹•å°‡é€£çµç™¼é€çµ¦å“¡å·¥
   - å¯ä»¥è€ƒæ…®æ•´åˆ Email æœå‹™ï¼ˆResendã€SendGrid ç­‰ï¼‰è‡ªå‹•ç™¼é€

3. **å“¡å·¥ä¿¡ç®±å·²è‡ªå‹•ç¢ºèª**
   - ä½¿ç”¨ `email_confirm: true`
   - å“¡å·¥ä¸éœ€è¦é»æ“Šé©—è­‰ä¿¡
   - ç›´æ¥ä½¿ç”¨å¯†ç¢¼é‡è¨­é€£çµè¨­å®šå¯†ç¢¼å³å¯

4. **äººå“¡æ¸…å†Šå®Œæ•´æ€§**
   - æ–°æµç¨‹ç¢ºä¿ `user_id` ç«‹å³å­˜åœ¨
   - å“¡å·¥è¨˜éŒ„å¯ä»¥ç«‹å³åœ¨å„ç³»çµ±ä¸­ä½¿ç”¨
   - ä¸æœƒå‡ºç¾ã€Œå¾…å•Ÿç”¨ã€çš„ç‹€æ…‹

### æœƒè¨ˆå“ç‰Œåˆ†é…

âš ï¸ **æ³¨æ„äº‹é …ï¼š**

1. **å¿…é ˆå…ˆæŒ‡å®šè§’è‰²**
   - åªæœ‰è§’è‰²ç‚ºã€Œæœƒè¨ˆã€çš„å“¡å·¥æœƒå‡ºç¾åœ¨åˆ†é…åˆ—è¡¨
   - è«‹å…ˆåœ¨ã€Œå“¡å·¥è³‡æ–™ã€Tab è¨­å®šæ­£ç¢ºçš„è§’è‰²

2. **åˆ†é…å³æ™‚ç”Ÿæ•ˆ**
   - ä¸éœ€è¦æœƒè¨ˆé‡æ–°ç™»å…¥
   - ä¸‹æ¬¡åˆ·æ–° Dashboard å³å¯çœ‹åˆ°è®Šæ›´

3. **ä¸€å€‹å“ç‰Œå¯ä»¥åˆ†é…çµ¦å¤šä½æœƒè¨ˆ**
   - æ”¯æ´å¤šä½æœƒè¨ˆå…±åŒè™•ç†åŒä¸€å“ç‰Œ
   - æ¡ˆä»¶æœƒå°æ‰€æœ‰è² è²¬è©²å“ç‰Œçš„æœƒè¨ˆå¯è¦‹

4. **æœªåˆ†é…çš„æœƒè¨ˆ**
   - å¦‚æœæœƒè¨ˆæ²’æœ‰åˆ†é…ä»»ä½•å“ç‰Œ
   - å°‡ç„¡æ³•åœ¨ä»˜æ¬¾ç³»çµ±çœ‹åˆ°å¾…ç°½æ ¸æ¡ˆä»¶
   - è«‹ç¢ºä¿æ¯ä½æœƒè¨ˆè‡³å°‘åˆ†é…ä¸€å€‹å“ç‰Œ

5. **è³‡æ–™åº«å¿…é ˆå·²åŸ·è¡Œ Migration**
   - å¿…é ˆå…ˆåŸ·è¡Œ `add_payment_system_enhancements.sql`
   - å¦å‰‡æœƒå‡ºç¾ã€Œè¡¨ä¸å­˜åœ¨ã€éŒ¯èª¤

---

## æœªä¾†æ”¹é€²å»ºè­°

### å“¡å·¥å…¥è·æµç¨‹

1. **è‡ªå‹•ç™¼é€ Email**
   - æ•´åˆ Resend æˆ– SendGrid
   - è‡ªå‹•ç™¼é€å¯†ç¢¼è¨­å®šé€£çµçµ¦æ–°å“¡å·¥
   - æä¾›ç¾è§€çš„ Email æ¨¡æ¿

2. **æ‰¹é‡åŒ¯å…¥**
   - æ”¯æ´ CSV æ‰¹é‡åŒ¯å…¥å“¡å·¥
   - é©åˆæ–°å…¬å¸å…¥è·å­£ç¯€

3. **å…¥è·é€²åº¦è¿½è¹¤**
   - é¡¯ç¤ºå“¡å·¥æ˜¯å¦å·²è¨­å®šå¯†ç¢¼
   - é¡¯ç¤ºã€Œå¾…å•Ÿç”¨ã€ã€ã€Œå·²å•Ÿç”¨ã€ç‹€æ…‹

### æœƒè¨ˆå“ç‰Œåˆ†é…

1. **æ‰¹é‡åˆ†é…**
   - æ”¯æ´ä¸€æ¬¡ç‚ºå¤šä½æœƒè¨ˆåˆ†é…ç›¸åŒå“ç‰Œ
   - é©åˆçµ„ç¹”é‡çµ„æ™‚ä½¿ç”¨

2. **åˆ†é…æ­·å²è¨˜éŒ„**
   - è¨˜éŒ„èª°åœ¨ä½•æ™‚ä¿®æ”¹äº†åˆ†é…
   - æä¾›å¯©è¨ˆè¿½è¹¤

3. **Dashboard æç¤º**
   - æœªåˆ†é…å“ç‰Œçš„æœƒè¨ˆç™»å…¥æ™‚é¡¯ç¤ºæç¤º
   - å¼•å°è¯ç¹«ç®¡ç†å“¡é€²è¡Œåˆ†é…

4. **å“ç‰Œè² è²¬äººçµ±è¨ˆ**
   - åœ¨å“ç‰Œåˆ—è¡¨ä¸­é¡¯ç¤ºæ¯å€‹å“ç‰Œçš„è² è²¬æœƒè¨ˆæ•¸é‡
   - é¿å…å“ç‰Œç„¡äººè² è²¬çš„æƒ…æ³

---

## æŠ€è¡“ç´°ç¯€

### Edge Function éŒ¯èª¤è™•ç†

```typescript
// Email å·²å­˜åœ¨
if (createUserError.message.includes('already registered')) {
  throw new Error(`æ­¤ Email (${email}) å·²è¢«è¨»å†Š...`)
}

// å“¡å·¥è¨˜éŒ„å‰µå»ºå¤±æ•—ï¼Œæ¸…ç†å¸³è™Ÿ
if (insertError) {
  await supabaseAdmin.auth.admin.deleteUser(userData.user.id)
  throw new Error(`å»ºç«‹å“¡å·¥è¨˜éŒ„å¤±æ•—: ${insertError.message}`)
}

// å¯†ç¢¼é‡è¨­ä¿¡ç™¼é€å¤±æ•—ï¼ˆä¸å½±éŸ¿ä¸»æµç¨‹ï¼‰
if (recoveryError) {
  console.warn('Failed to send password reset email:', recoveryError.message)
  // ä¸æ‹‹å‡ºéŒ¯èª¤ï¼Œåªè¨˜éŒ„è­¦å‘Š
}
```

### å‰ç«¯è³‡æ–™æµ

```javascript
// ç²å–æœƒè¨ˆäººå“¡
const accountants = await supabase
  .from('employees')
  .select('*')
  .eq('role', 'accountant')
  .eq('status', 'active')

// ç²å–å“ç‰Œ
const brands = await supabase
  .from('brands')
  .select('*')

// ç²å–åˆ†é…é—œä¿‚
const assignments = await supabase
  .from('accountant_brands')
  .select('*')

// æ·»åŠ åˆ†é…
await supabase
  .from('accountant_brands')
  .insert({
    employee_id: accountantId,
    brand_id: brandId
  })
```

---

## å•é¡Œæ’æŸ¥

### å“¡å·¥å»ºç«‹å¤±æ•—

**ç—‡ç‹€ï¼š** é»æ“Šã€Œå»ºç«‹ã€å¾Œé¡¯ç¤ºéŒ¯èª¤

**å¯èƒ½åŸå› ï¼š**
1. Email å·²è¢«ä½¿ç”¨ â†’ æ›´æ› Email
2. Edge Function æœªéƒ¨ç½² â†’ åŸ·è¡Œ `supabase functions deploy invite-employee`
3. ç’°å¢ƒè®Šæ•¸æœªè¨­å®š â†’ æª¢æŸ¥ `SUPABASE_SERVICE_ROLE_KEY`

### æœƒè¨ˆå“ç‰Œåˆ†é…ä¸é¡¯ç¤º

**ç—‡ç‹€ï¼š** ã€Œæœƒè¨ˆå“ç‰Œåˆ†é…ã€Tab æ²’æœ‰æœƒè¨ˆäººå“¡

**å¯èƒ½åŸå› ï¼š**
1. æ²’æœ‰è§’è‰²ç‚ºã€Œæœƒè¨ˆã€çš„å“¡å·¥ â†’ åœ¨ã€Œå“¡å·¥è³‡æ–™ã€ä¸­è¨­å®šè§’è‰²
2. å“¡å·¥ç‹€æ…‹ä¸æ˜¯ã€Œåœ¨è·ã€â†’ æª¢æŸ¥å“¡å·¥ç‹€æ…‹

### å“ç‰Œåˆ—è¡¨ç‚ºç©º

**ç—‡ç‹€ï¼š** ç„¡æ³•æ·»åŠ å“ç‰Œï¼ˆä¸‹æ‹‰é¸å–®ç‚ºç©ºï¼‰

**å¯èƒ½åŸå› ï¼š**
1. `payment_approval.brands` è¡¨æ²’æœ‰è³‡æ–™ â†’ å…ˆåœ¨ä»˜æ¬¾ç³»çµ±å»ºç«‹å“ç‰Œ
2. Schema æœªæš´éœ² â†’ æª¢æŸ¥ `config.toml` ä¸­çš„ `schemas` è¨­å®š

### æœƒè¨ˆçœ‹ä¸åˆ°æ¡ˆä»¶

**ç—‡ç‹€ï¼š** æœƒè¨ˆç™»å…¥ä»˜æ¬¾ç³»çµ±å¾Œ Dashboard ç‚ºç©º

**å¯èƒ½åŸå› ï¼š**
1. è©²æœƒè¨ˆæ²’æœ‰åˆ†é…ä»»ä½•å“ç‰Œ â†’ åœ¨ç®¡ç†ä¸­å¿ƒé€²è¡Œåˆ†é…
2. æ²’æœ‰è©²å“ç‰Œçš„å¾…ç°½æ ¸æ¡ˆä»¶ â†’ æª¢æŸ¥æ˜¯å¦æœ‰æ¡ˆä»¶è™•æ–¼ã€Œå¾…æœƒè¨ˆç°½æ ¸ã€ç‹€æ…‹
3. Dashboard æŸ¥è©¢é‚è¼¯æœªæ›´æ–° â†’ ç¢ºèªå·²ä½¿ç”¨ `accountant_pending_requests` è¦–åœ–

---

## è¯çµ¡èˆ‡æ”¯æ´

å¦‚æœ‰å•é¡Œï¼Œè«‹è¯ç¹«ï¼š
- ç³»çµ±ç®¡ç†å“¡
- é–‹ç™¼åœ˜éšŠ

ç›¸é—œæ–‡ä»¶ï¼š
- [ä»˜æ¬¾ç³»çµ±å‡ç´šæŒ‡å—](./PAYMENT_MULTI_STORE_UPGRADE.md)
- [Supabase æ–‡æª”](https://supabase.com/docs)
